{extend name='extra@spl/content' /}

{block name="button"}

{/block}
{block name="style"}
<link rel="stylesheet"
      href="/static/admin/dataTables.bootstrap.css">
{/block}
{block name="content"}

<main class="main">

  <div class="atw-inquiry">
    <form class="form-inline">
      <input type="hidden" id="tag_hid" name="tag" value="{$Think.get.tag}">
      <span>合同状态:
        <select name="status" id="status">
          <option value="all">全部</option>
          {volist name='orderstatus' id='pstatus'}
            <option value="{$key}" {eq name="$key" value="$Think.get.status" }selected{/eq}>{$pstatus}</option>
          {/volist}</select></span>
      <span>合同签订日期：
          <input class="laydate-icon" type="text" id="contract_begintime">
          到
          <input class="laydate-icon" id="contract_endtime" type="text">
        </span>
      <button class="btn btn-primary" id="searchVal" type="button">查询</button>
    </form>
    <button type="button" id="excel_out" class="btn btn-info">导出Excel</button>
  </div>
  <div class="table-responsive">
    <table class="table table-bordered  atw-order-tab" id="example">
      <thead>
      <tr class="active">
        <td>订单编号</td>
        <td>物料交付情况</td>
        <td>合同签订情况</td>
        <td>合同签订日期</td>
        <td>操作</td>
      </tr>
      </thead>
      <tbody>
      <tr>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
      </tr>
      </tbody>
    </table>
  </div>
</main>

{/block}

{block name="script"}
<script src="/static/spl/order/index.js"></script>
<script>
  var orderTables;
  require(["jquery.dataTables", "icheck"], function(){
    require(["dataTables.bootstrap"], function(){
      $(document).ready(function(){
        initPage();
        $.fn.dataTable.ext.errMode = 'none';
      });
    })

    function initPage(){
      // datatable
      orderTables = $('#example').DataTable({
        //"paging": false, //设置是否分页
        "info":true,  //去除左下角的信息
        "lengthChange":false, //是否允许用户改变表格每页显示的记录数
        "ordering":false, //是否允许Datatables开启排序
        "searching":false,  //是否允许Datatables开启本地搜索
        "processing":true,
        //"serverSide": true,
        "ajax":{
          "url":'{:url("Order/getOrderList")}',
          "type":"POST",
          "data":function(parameter){
            parameter.status = $("#status").val();
            parameter.contract_begintime = $("#contract_begintime").val();
            parameter.contract_endtime = $("#contract_endtime").val();
            parameter.tag = $("#tag_hid").val();
          }
        },
        "pageLength":10,
        language:{
          "oPaginate":{
            "sFirst":"首页",
            "sPrevious":"上页",
            "sNext":"下页",
            "sLast":"末页"
          },
          "info":"当前总记录数_TOTAL_条"
        },
        "columns":[
          {"data":"order_code"},
          {"data":"exec_desc"},
          {"data":"status"},
          {"data":"contract_time"},
          {"data":"id"},
        ],
        "drawCallback":function(settings){
        },
        "createdRow":function(row, data, index){
          $('td', row).eq(1).attr('style', 'text-align: left;');
        },
        "columnDefs":[
          {
            "targets":4,
            "data":null,
            "render":function(data){
              var url = '{:url(\'Order/detail\')}?id=' + data;
              return '<a href="javascript:void(0);"  data-open="' + url + '" >详情</a>';
            }
          }
        ],
      });
    }
  })
  $("#searchVal").on('click', function(){
    //console.log(orderTables);
    orderTables.ajax.reload();
  })

  //导出
  $("#excel_out").click(function(){
    var status = $("#status").val()||'';
    var contract_begintime = $("#contract_begintime").val()||'';
    var contract_endtime = $("#contract_endtime").val()||'';
    var tag = $("#tag_hid").val()||'';
    var str = "{:url('Order/exportPiList')}"
        + '?status=' + status
        + '&contract_begintime=' + contract_begintime
        + '&contract_endtime=' + contract_endtime
        + '&tag=' + tag;
    window.open(str);
    //console.log(str);
  });
</script>
{/block}